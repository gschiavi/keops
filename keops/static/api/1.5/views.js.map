{
  "version": 3,
  "file": "views.js",
  "sourceRoot": "",
  "sources": [
    "views.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nclass SearchMenu\n  constructor: (@element, @parent, @options) ->\n    @input = @parent.find('.search-view-input')\n    @input.on 'keyup', (evt) =>\n      if @input.val().length\n        @show()\n      else\n        @close()\n    .on 'keydown', (evt) =>\n      switch evt.which\n        when $.ui.keyCode.BACKSPACE\n          if @input.val() is ''\n            item = @searchView.query.items[@searchView.query.items.length-1]\n            @searchView.onRemoveItem(evt, item)\n          break\n    .on 'blur', (evt) =>\n      @input.val('')\n      @close()\n\n  link: ->\n    @element.hide()\n\n  show: ->\n    @element.show()\n\n  close: ->\n    @element.hide()\n    @reset()\n\n  expand: (item) ->\n    scope = @searchView.scope\n    scope.model.getFieldChoices(item.ref.name, scope.search.text)\n    .then (res) =>\n      console.log res\n      if res.ok\n        for obj in res.result.items\n          @searchView.loadItem(item.item, obj, item)\n\n  collapse: (item) ->\n    for i in item.children\n      i.remove()\n    item.children = []\n\n  reset: ->\n    for i in @searchView.items\n      if i.children and i.children.length\n        @collapse(i)\n        i.reset()\n\n  select: (evt, item) ->\n    if @options.select\n      if item.parentItem\n        item.parentItem.value = item.value\n        item = item.parentItem\n      item.searchString = @input.val()\n      @options.select(evt, item)\n      @input.val('')\n\n\nclass SearchQuery\n  constructor: (@searchView) ->\n    @items = []\n    @groups = []\n\n  add: (item) ->\n    if item in @items\n      item.facet.addValue(item)\n      item.facet.refresh()\n    else\n      @items.push(item)\n      @searchView.renderFacets()\n    if item instanceof SearchGroup\n      @groups.push(item)\n    @searchView.change()\n\n  remove: (item) ->\n    @items.splice(@items.indexOf(item), 1)\n    item.facet.element.remove()\n    delete item.facet\n    if item instanceof SearchGroup\n      @groups.splice(@groups.indexOf(item), 1)\n    @searchView.change()\n\n  getParams: ->\n    r = []\n    for i in @items\n      r = r.concat(i.getParamValues())\n    console.log('params', r)\n    return r\n\n\n# TODO remove this class\nclass FacetView\n  constructor: (@item) ->\n    @values = [{searchString: @item.getDisplayValue(), value: @item.value}]\n\n  addValue: (@item) ->\n    @values.push({searchString: @item.getDisplayValue(), value: @item.value})\n\n  templateValue: ->\n    sep = \"\"\" <span class=\"facet-values-separator\">#{Katrid.i18n.gettext('or')}</span> \"\"\"\n    return (s.searchString for s in @values).join(sep)\n\n  template: ->\n    s = \"\"\"<span class=\"facet-label\">#{@item.getFacetLabel()}</span>\"\"\"\n    \"\"\"<div class=\"facet-view\">\n#{s}\n<span class=\"facet-value\">#{@templateValue()}</span>\n<span class=\"fa fa-sm fa-remove facet-remove\"></span>\n</div>\"\"\"\n\n  link: (searchView) ->\n    html = $(@template())\n    @item.facet = @\n    @element = html\n    rm = html.find('.facet-remove')\n    rm.click (evt) =>\n      searchView.onRemoveItem(evt, @item)\n    return html\n\n  refresh: ->\n    @element.find('.facet-value').html(@templateValue())\n\n\nclass SearchItem\n  constructor: (@name, @item, @parent, @ref, @menu) ->\n    @label = @item.attr('label') or (@ref and @ref['caption']) or @name\n\n  templateLabel: ->\n    \"\"\" Pesquisar <i>#{@label}</i> por: <strong>${search.text}</strong>\"\"\"\n\n  template: ->\n    s = ''\n    if @expandable\n      s = \"\"\"<a class=\"expandable\" href=\"#\"></a>\"\"\"\n    if @value\n      s = \"\"\"<a class=\"search-menu-item indent\" href=\"#\">#{@value[1]}</a>\"\"\"\n    else\n      s += \"<a href=\\\"#\\\" class=\\\"search-menu-item\\\">#{@templateLabel()}</a>\"\n    return \"\"\"<li>#{s}</li>\"\"\"\n\n  link: (scope, $compile, parent) ->\n    html = $compile(@template())(scope)\n    if parent?\n      html.insertAfter(parent.element)\n      parent.children.push(@)\n      @parentItem = parent\n    else\n      html.appendTo(@parent)\n\n    @element = html\n\n    @itemEl = html.find('.search-menu-item').click (evt) ->\n      evt.preventDefault()\n    .mousedown (evt) =>\n      evt.stopPropagation()\n      evt.preventDefault()\n      @menu.select(evt, @)\n      @menu.close()\n\n    @expand = html.find('.expandable').on 'mousedown', (evt) =>\n      @expanded = not @expanded\n      evt.stopPropagation()\n      evt.preventDefault()\n      $(evt.target).toggleClass('expandable expanded')\n      if @expanded\n        @searchView.menu.expand(@)\n      else\n        @searchView.menu.collapse(@)\n    .click (evt) ->\n      evt.preventDefault()\n    return false\n\n  getFacetLabel: ->\n    console.log('get facet label')\n    return @label\n\n  getDisplayValue: ->\n    if @value\n      return @value[1]\n    return @searchString\n\n  getValue: ->\n    return (s.value or s.searchString for s in @facet.values)\n\n  getParamValue: (name, value) ->\n    r = {}\n    if $.isArray(value)\n      r[name] = value[0]\n    else\n      r[name + '__icontains'] = value\n    return r\n\n  getParamValues: ->\n    r = []\n    for v in @getValue()\n      r.push(@getParamValue(@name, v))\n    if r.length > 1\n      return [{'OR': r}]\n    return r\n\n  remove: ->\n    @element.remove()\n\n  reset: ->\n    @expanded = false\n    @expand.removeClass('expanded')\n    @expand.addClass('expandable')\n\n\nclass SearchField extends SearchItem\n  constructor: (name, item, parent, ref, menu) ->\n    super name, item, parent, ref, menu\n    if ref.type is 'ForeignKey'\n      @expandable = true\n      @children = []\n    else\n      @expandable = false\n\n\nclass SearchFilter extends SearchItem\n\n\nclass SearchGroup extends SearchItem\n  constructor: (name, item, parent, ref, menu) ->\n    super name, item, parent, ref, menu\n    ctx = item.attr('context')\n    console.log(item)\n    if typeof ctx is 'string'\n      @context = JSON.parse(ctx)\n    else\n      @context =\n        grouping: [name]\n\n  getFacetLabel: ->\n    '<span class=\"fa fa-bars\"></span>'\n\n  templateLabel: ->\n    Katrid.i18n.gettext('Group by:') + ' ' + @label\n\n  getDisplayValue: ->\n    return @label\n\n\nclass SearchView\n  constructor: (@scope, options) ->\n    @query = new SearchQuery(@)\n    @items = []\n\n  createMenu: (scope, el, parent) ->\n    menu = new SearchMenu(el, parent, {select: @onSelectItem})\n    menu.searchView = @\n    return menu\n\n  template: ->\n    html = \"\"\"\n<div class=\"search-area\">\n  <div class=\"search-view\">\n    <div class=\"search-view-facets\"></div>\n    <input class=\"search-view-input\" role=\"search\" placeholder=\"#{Katrid.i18n.gettext('Search...')}\" ng-model=\"search.text\">\n    <span class=\"search-view-more fa fa-search-plus\"></span>\n  </div>\n  <div class=\"col-sm-12\">\n  <ul class=\"dropdown-menu search-view-menu\" role=\"menu\"></ul>\n  </div>\n</div>\n\"\"\"\n\n  link: (scope, el, attrs, controller, $compile) ->\n    html = $compile(@template())(scope)\n    el.replaceWith(html)\n    html.addClass(attrs.class)\n\n    @$compile = $compile\n    @view = scope.views.search\n    @viewContent = $(@view.content)\n    @element = html\n    @searchView = html.find('.search-view')\n    html.find('.search-view-more').click (evt) =>\n      $(evt.target).toggleClass('fa-search-plus fa-search-minus')\n      @viewMoreToggle()\n    @menu = @createMenu(scope, $(html.find('.dropdown-menu.search-view-menu')), html)\n    @menu.searchView = @\n    @menu.link()\n\n    # input key control events\n    @menu.input.on 'keydown', (evt) ->\n\n    # add items to menu\n    for item in @viewContent.children()\n      @loadItem $(item)\n    return\n\n  loadItem: (item, value, parent, cls) ->\n    tag = item.prop('tagName')\n    if not cls?\n      if tag is 'FIELD'\n        cls = SearchField\n      else if tag is 'FILTER'\n        cls = SearchFilter\n      else if tag is 'GROUP'\n        console.log('group', item)\n        for grouping in item.children()\n          @loadItem($(grouping), null, null, SearchGroup)\n        return\n\n    name = item.attr('name')\n    item = new cls(name, item, @menu.element, @view.fields[name], @menu)\n    item.searchView = @\n    if value\n      item.expandable = false\n      item.value = value\n    item.link(@scope, @$compile, parent)\n\n    @items.push(item)\n\n  renderFacets: ->\n    for item in @query.items\n      if not item.facet\n        f = new FacetView(item)\n        el = f.link(@)\n        el.insertBefore(@menu.input)\n\n  viewMoreToggle: ->\n    @viewMore = not @viewMore\n    @scope.$apply =>\n      console.log(@viewMore)\n      @scope.search.viewMoreButtons = @viewMore\n\n  onSelectItem: (evt, obj) =>\n    @query.add(obj)\n\n  onRemoveItem: (evt, obj) =>\n    @query.remove(obj)\n\n  change: ->\n    if @query.groups.length or (@scope.dataSource.groups and @scope.dataSource.groups.length)\n      @scope.action.applyGroups(@query.groups)\n    if @query.groups.length is 0\n      @scope.action.setSearchParams(@query.getParams())\n\n\nKatrid.UI.Views =\n  SearchView: SearchView\n  SearchMenu: SearchMenu\n"
  ]
}